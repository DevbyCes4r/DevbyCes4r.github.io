---
import { SEO } from "../utils/seo";
import "../styles/global.css";

import ThemeToggle from "../components/ThemeToggle.astro";

interface Props {
  title: string;
  description: string;
  image?: string;
  article?: boolean;
}

const { title, description, image, article } = Astro.props;
const { site } = Astro;
const canonicalURL = new URL(Astro.url.pathname, site);
const socialImageURL = new URL(image || "/og-default.jpg", site);

const author = "Cesar Nuñez"; // Update with actual name
const twitterHandle = "@devbyces4r"; // Update with actual handle
---

<!doctype html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <meta name="generator" content={Astro.generator} />

    <!-- Resource Hints para optimizar carga -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link rel="dns-prefetch" href="https://gc.zgo.at" />

    <!-- SEO -->
    <title>{title}</title>
    <meta name="description" content={description} />
    <link rel="canonical" href={canonicalURL} />

    <!-- Open Graph -->
    <meta property="og:title" content={title} />
    <meta property="og:description" content={description} />
    <meta property="og:url" content={canonicalURL} />
    <meta property="og:image" content={socialImageURL} />
    <meta property="og:type" content={article ? "article" : "website"} />
    <meta property="og:site_name" content="DevbyCes4r" />

    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:creator" content={twitterHandle} />
    <meta name="twitter:title" content={title} />
    <meta name="twitter:description" content={description} />
    <meta name="twitter:image" content={socialImageURL} />

    <!-- AI / LLM Specific Meta Tags -->
    <meta
      name="robots"
      content="index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1"
    />
    <meta name="gptbot" content="index, follow" />
    <meta name="google-extended" content="index, follow" />

    <!-- Optimized Font Loading -->
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap"
      media="print"
      onload="this.media='all'"
    />
    <noscript>
      <link
        rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap"
      />
    </noscript>

    <!-- Analytics - Deferred Loading -->
    <!-- GoatCounter Analytics - carga diferida para no bloquear renderizado -->
    <script>
      // Cargar GoatCounter solo después de que la página esté lista
      if (document.readyState === "complete") {
        loadGoatCounter();
      } else {
        window.addEventListener("load", loadGoatCounter);
      }

      function loadGoatCounter() {
        const script = document.createElement("script");
        script.async = true;
        script.src = "//gc.zgo.at/count.js";
        script.setAttribute(
          "data-goatcounter",
          "https://devbyces4r.goatcounter.com/count",
        );
        document.head.appendChild(script);
      }
    </script>

    <slot name="head" />
  </head>
  <body
    class="bg-slate-50 dark:bg-slate-900 text-slate-900 dark:text-slate-100 min-h-screen flex flex-col transition-colors duration-300"
  >
    <header
      class="py-6 px-4 border-b border-slate-200 dark:border-slate-800 bg-white/80 dark:bg-slate-900/50 backdrop-blur-md sticky top-0 z-50"
    >
      <nav class="max-w-4xl mx-auto flex justify-between items-center">
        <a
          href="/"
          class="text-xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-blue-600 via-purple-600 to-pink-600 dark:from-blue-400 dark:via-purple-500 dark:to-pink-500"
        >
          DevbyCes4r
        </a>
        <div class="flex gap-4 items-center">
          <a
            href="/blog"
            class="text-slate-700 dark:text-slate-300 hover:text-blue-600 dark:hover:text-blue-400 transition-colors"
            >Blog</a
          >
          <a
            href="/cursos"
            class="text-slate-700 dark:text-slate-300 hover:text-blue-600 dark:hover:text-blue-400 transition-colors"
            >Cursos</a
          >
          <a
            href="/packs"
            class="hidden sm:block text-slate-700 dark:text-slate-300 hover:text-blue-600 dark:hover:text-blue-400 transition-colors"
            >Packs</a
          >
          <a
            href="/herramientas"
            class="hidden md:block text-slate-700 dark:text-slate-300 hover:text-blue-600 dark:hover:text-blue-400 transition-colors"
            >Herramientas</a
          >
          <ThemeToggle />
        </div>
      </nav>
    </header>
  </body>

  <main class="flex-grow max-w-4xl mx-auto w-full px-4 py-8">
    <slot />
  </main>

  <footer
    class="py-8 px-4 text-center text-slate-600 dark:text-slate-400 text-sm"
  >
    <p>&copy; {new Date().getFullYear()} {author}. Hecho con ❤️ y Astro.</p>
    <div class="mt-2 flex justify-center gap-4">
      <a
        href="/rss.xml"
        class="hover:text-blue-600 dark:hover:text-white transition-colors"
        >RSS</a
      >
      <a
        href="/sitemap-index.xml"
        class="hover:text-blue-600 dark:hover:text-white transition-colors"
        >Sitemap</a
      >
    </div>
  </footer>
</html>
