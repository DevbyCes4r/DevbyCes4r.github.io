---

---

<div class="max-w-4xl mx-auto">
    <div
        class="bg-white dark:bg-slate-800 rounded-3xl shadow-2xl overflow-hidden border border-slate-200 dark:border-slate-700"
    >
        <!-- Header Area -->
        <div class="bg-gradient-to-r from-purple-600 to-pink-600 p-1">
            <div class="bg-white dark:bg-slate-800 p-6 md:p-8 rounded-t-[20px]">
                <div class="flex flex-col gap-6">
                    <!-- Text Input -->
                    <div class="w-full">
                        <label
                            for="text-input"
                            class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2"
                        >
                            Texto a convertir
                        </label>
                        <textarea
                            id="text-input"
                            rows="5"
                            class="w-full px-4 py-3 rounded-xl bg-slate-50 dark:bg-slate-900 border border-slate-200 dark:border-slate-700 focus:ring-2 focus:ring-purple-500 focus:border-transparent resize-none transition-all"
                            placeholder="Escribe aquí el texto que quieres escuchar..."
                        ></textarea>
                    </div>

                    <!-- Controls Grid -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <!-- Voice Selection -->
                        <div>
                            <label
                                for="voice-select"
                                class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2"
                            >
                                Voz
                            </label>
                            <select
                                id="voice-select"
                                class="w-full px-4 py-3 rounded-xl bg-slate-50 dark:bg-slate-900 border border-slate-200 dark:border-slate-700 focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                            >
                                <option value="">Cargando voces...</option>
                            </select>
                        </div>

                        <!-- Settings -->
                        <div class="space-y-4">
                            <div>
                                <label
                                    class="flex justify-between text-sm font-medium text-slate-700 dark:text-slate-300 mb-2"
                                >
                                    <span>Velocidad</span>
                                    <span id="rate-value">1x</span>
                                </label>
                                <input
                                    type="range"
                                    id="rate"
                                    min="0.5"
                                    max="2"
                                    step="0.1"
                                    value="1"
                                    class="w-full h-2 bg-slate-200 dark:bg-slate-700 rounded-lg appearance-none cursor-pointer accent-purple-600"
                                />
                            </div>

                            <div>
                                <label
                                    class="flex justify-between text-sm font-medium text-slate-700 dark:text-slate-300 mb-2"
                                >
                                    <span>Tono</span>
                                    <span id="pitch-value">1</span>
                                </label>
                                <input
                                    type="range"
                                    id="pitch"
                                    min="0.5"
                                    max="2"
                                    step="0.1"
                                    value="1"
                                    class="w-full h-2 bg-slate-200 dark:bg-slate-700 rounded-lg appearance-none cursor-pointer accent-purple-600"
                                />
                            </div>
                        </div>
                    </div>

                    <!-- Action Buttons -->
                    <div class="flex flex-wrap justify-center gap-4 mt-4">
                        <button
                            id="speak-btn"
                            class="flex items-center gap-2 px-8 py-4 bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-500 hover:to-pink-500 text-white rounded-2xl font-bold text-lg transition-all hover:scale-105 hover:shadow-lg hover:shadow-purple-500/25 active:scale-95"
                        >
                            <span class="text-2xl">▶️</span>
                            Reproducir
                        </button>

                        <button
                            id="stop-btn"
                            class="flex items-center gap-2 px-8 py-4 bg-slate-200 dark:bg-slate-700 text-slate-700 dark:text-slate-200 rounded-2xl font-bold text-lg transition-all hover:scale-105 hover:bg-slate-300 dark:hover:bg-slate-600 active:scale-95"
                        >
                            <span class="text-2xl">⏹️</span>
                            Detener
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <div
            class="bg-slate-50 dark:bg-slate-900/80 p-6 md:p-8 border-t border-slate-200 dark:border-slate-700"
        >
            <h3 class="font-bold text-slate-900 dark:text-white mb-2">
                ✨ Características:
            </h3>
            <ul
                class="grid grid-cols-1 md:grid-cols-2 gap-2 text-sm text-slate-600 dark:text-slate-400"
            >
                <li class="flex items-center gap-2">
                    ✅ Voces nativas del sistema
                </li>
                <li class="flex items-center gap-2">
                    ✅ Funciona sin internet
                </li>
                <li class="flex items-center gap-2">
                    ✅ Control de velocidad y tono
                </li>
                <li class="flex items-center gap-2">✅ Privacidad total</li>
            </ul>
        </div>
    </div>
</div>

<script>
    const synth = window.speechSynthesis;
    const textInput = document.getElementById(
        "text-input",
    ) as HTMLTextAreaElement;
    const voiceSelect = document.getElementById(
        "voice-select",
    ) as HTMLSelectElement;
    const rateInput = document.getElementById("rate") as HTMLInputElement;
    const pitchInput = document.getElementById("pitch") as HTMLInputElement;
    const rateValue = document.getElementById("rate-value") as HTMLSpanElement;
    const pitchValue = document.getElementById(
        "pitch-value",
    ) as HTMLSpanElement;
    const speakBtn = document.getElementById("speak-btn") as HTMLButtonElement;
    const stopBtn = document.getElementById("stop-btn") as HTMLButtonElement;

    let voices: SpeechSynthesisVoice[] = [];

    function populateVoiceList() {
        voices = synth.getVoices().sort((a, b) => {
            const aname = a.name.toUpperCase();
            const bname = b.name.toUpperCase();
            if (aname < bname) return -1;
            else if (aname == bname) return 0;
            return +1;
        });

        voiceSelect.innerHTML = "";

        // Group voices by language
        const spanishVoices = voices.filter((v) => v.lang.startsWith("es"));
        const englishVoices = voices.filter((v) => v.lang.startsWith("en"));
        const otherVoices = voices.filter(
            (v) => !v.lang.startsWith("es") && !v.lang.startsWith("en"),
        );

        const addOption = (voice: SpeechSynthesisVoice) => {
            const option = document.createElement("option");
            option.textContent = `${voice.name} (${voice.lang})`;
            option.setAttribute("data-lang", voice.lang);
            option.setAttribute("data-name", voice.name);
            voiceSelect.appendChild(option);
        };

        if (spanishVoices.length > 0) {
            const group = document.createElement("optgroup");
            group.label = "Español";
            voiceSelect.appendChild(group);
            spanishVoices.forEach((v) => {
                const option = document.createElement("option");
                option.textContent = `${v.name} (${v.lang})`;
                option.setAttribute("data-lang", v.lang);
                option.setAttribute("data-name", v.name);
                group.appendChild(option);
            });
        }

        // Add others...
        [...englishVoices, ...otherVoices].forEach(addOption);
    }

    populateVoiceList();
    if (speechSynthesis.onvoiceschanged !== undefined) {
        speechSynthesis.onvoiceschanged = populateVoiceList;
    }

    function speak() {
        if (synth.speaking) {
            console.error("speechSynthesis.speaking");
            return;
        }

        if (textInput.value !== "") {
            const utterThis = new SpeechSynthesisUtterance(textInput.value);

            utterThis.onend = function (event) {
                console.log("SpeechSynthesisUtterance.onend");
            };

            utterThis.onerror = function (event) {
                console.error("SpeechSynthesisUtterance.onerror");
            };

            const selectedOption =
                voiceSelect.selectedOptions[0].getAttribute("data-name");
            for (let i = 0; i < voices.length; i++) {
                if (voices[i].name === selectedOption) {
                    utterThis.voice = voices[i];
                    break;
                }
            }

            utterThis.pitch = parseFloat(pitchInput.value);
            utterThis.rate = parseFloat(rateInput.value);
            synth.speak(utterThis);
        }
    }

    speakBtn.addEventListener("click", (e) => {
        e.preventDefault();
        speak();
    });

    stopBtn.addEventListener("click", (e) => {
        e.preventDefault();
        synth.cancel();
    });

    rateInput.addEventListener("input", () => {
        rateValue.textContent = rateInput.value + "x";
    });

    pitchInput.addEventListener("input", () => {
        pitchValue.textContent = pitchInput.value;
    });
</script>
